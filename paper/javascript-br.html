<!DOCTYPE html>
<html>
  <head>
    <link rel="icon" href="../icons/wallpaper/aranha.png"/>
    <link rel="stylesheet" type="text/css" href="../css/paper.css">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ofuscação e Deofuscação de JavaScript</title>
  </head>
  <body>
    </header>
    <main>
      <div class="post">
<div class="header">
  <h1>Ofuscação e Deofuscação de JavaScript</h1>
<p>28 de maio de 2024 | Autor: Maiquel Paiva (<a href="https://twitter.com/untw0">@untw0</a>)</p><br></div>

<h1>Introdução</h1>
<p>Em ambientes digitais, muitos atores mal-intencionados recorrem à prática de ofuscar seu código, tornando-o menos detectável por sistemas de segurança e menos compreensível para outros desenvolvedores. A habilidade de deofuscar tal código é uma técnica valiosa em vários contextos do mundo real, como na avaliação de aplicações web, permitindo a identificação de tentativas por parte dos desenvolvedores de ocultar dados sensíveis. Além disso, defensores podem usar essa habilidade para analisar e deofuscar códigos responsáveis por ataques, como em casos de phishing.</p>
  
<p>Atores mal-intencionados têm várias razões para ofuscar seu código. Entre elas, destacam-se a intenção de evitar a detecção por sistemas de segurança, dificultar a análise por analistas de segurança, proteger propriedade intelectual e facilitar a disseminação de ataques, como phishing. Em geral, a ofuscação de código é uma prática comum entre atores maliciosos, usada para aumentar a eficácia e a furtividade de suas atividades maliciosas.</p>

<h1>Ofuscação</h1>
<p>Um exemplo típico de ofuscação de código envolve transformar um código JavaScript simples em uma versão altamente ofuscada. Por exemplo, ofuscadores de código muitas vezes transformam o código em um dicionário de todas as palavras e símbolos usados dentro do código e, em seguida, tentam reconstruir o código original durante a execução, referindo-se a cada palavra e símbolo do dicionário. A seguir está um exemplo de um código JavaScript simples sendo ofuscado:</p>
<p><h2>Código Não Ofuscado:</h2></p>
<p><img src="../icons/javascript/simples.png"></p>
<p><h2>Código Ofuscado:</h2></p>
<p><img src="../icons/javascript/complicado.png"></p>

<p>A ofuscação geralmente é feita através de ferramentas automatizadas disponíveis para várias linguagens de programação. Embora muitas ferramentas online realizem essa tarefa, atores mal-intencionados e desenvolvedores profissionais frequentemente criam suas próprias ferramentas para aumentar a dificuldade da deofuscação.</p>
  
<p>Uma forma comum de reduzir a legibilidade do código JavaScript, mantendo-o funcional, é a minificação. A minificação comprime o código em uma única linha, o que é particularmente útil para scripts maiores. No entanto, a minificação é apenas um primeiro passo comparado a técnicas de ofuscação mais avançadas.</p>
  
<p>O exemplo acima usa uma técnica de ofuscação conhecida como "packing," reconhecível pelos seis argumentos de função usados na função inicial function(p,a,c,k,e,d). Ferramentas de packing geralmente convertem todas as palavras e símbolos no código em uma lista ou dicionário e, em seguida, referem-se a eles usando a função (p,a,c,k,e,d) para reconstruir o código original durante a execução. O padrão (p,a,c,k,e,d) pode variar entre diferentes packers, mas geralmente segue uma ordem específica para organizar as palavras e símbolos do código original.</p>

<h1 id="recap-and-questions">Recapitulação e Perguntas</h1>

<p>Por que a ofuscação é frequentemente usada com JavaScript?</p>
ㅤ
<p>Códigos em linguagens interpretadas como Python, PHP e JavaScript são publicados e executados diretamente sem precisar ser compilados. Enquanto Python e PHP geralmente são usados no lado do servidor, invisíveis aos usuários, o JavaScript é comumente usado nos navegadores dos usuários, onde o código é visível e executado diretamente. Portanto, é frequentemente necessário ofuscar o código JavaScript para protegê-lo.</p>
ㅤ
<p>A Ofuscação Pode Ser Usada para Atividades Maliciosas?</p>
ㅤ
<p>Sim, a ofuscação pode ser usada para atividades maliciosas. Atores mal-intencionados frequentemente empregam essa técnica para esconder o propósito e a funcionalidade de seu código, dificultando a detecção por sistemas de segurança e a análise por analistas de segurança.</p>

<h1>Exemplo de Ofuscação para Usos Maliciosos</h1>

<h2>Código de Phishing Não Ofuscado:</h2>
<p><img src="../icons/javascript/phising.png"></p>

<h2>Código de Phishing Ofuscado:</h2>
<p><img src="../icons/javascript/phising-obfuscado.png"></p>

<p>O código de phishing não ofuscado em JS captura dados de login inseridos pelo usuário e os envia para um servidor controlado por um atacante. Quando ofuscado, o código se torna significativamente mais difícil de entender, complicando a detecção do comportamento malicioso.</p>

<h1>Roubo de Informações Pessoais</h1>

<h2>Código Não Ofuscado:</h2>
<p><img src="../icons/javascript/roubo.png"></p>
<h2>Código Ofuscado:</h2>
<p><img src="../icons/javascript/roubo-ofuscado.png"></p>

<p>A ofuscação pode ser usada para esconder scripts que coletam informações pessoais, como números de cartões de crédito, endereços e outras informações sensíveis, e as enviam para um servidor controlado por um atacante.</p>

<h1>Um Exemplo Real de Malware Ofuscado</h1>
<p>A ofuscação é uma técnica usada para tornar um script mais difícil de ler por humanos, mantendo sua funcionalidade do ponto de vista técnico, embora possa impactar o desempenho. Tipicamente, essa técnica é aplicada automaticamente por ferramentas de ofuscação que pegam o código original e o reescrevem de uma forma que o torna mais complexo de ler.</p>

<h2>Selfbot do Discord</h2>
<p>Métodos de ofuscação são frequentemente usados por indivíduos mal-intencionados no Discord para criar "selfbots." Selfbots são scripts que permitem a um usuário automatizar ações na plataforma Discord, muitas vezes violando os Termos de Serviço do Discord. Vamos ver como isso funciona:</p>
<p><img src="../icons/javascript/selfbot.png"></p>

<h2>Operação de um Selfbot Malicioso</h2>
<p>Esses métodos de ofuscação são frequentemente usados por indivíduos mal-intencionados no Discord. Eles criam um "selfbot" que, quando executado, compromete o computador do usuário, muitas vezes sem o conhecimento dele. Vamos examinar como isso funciona, começando com a estrutura do selfbot.</p>

<h2>Estrutura de Pastas do Selfbot</h2>
<p>A estrutura de pastas do selfbot geralmente é bem organizada, fazendo parecer um script legítimo. No entanto, pode conter malware, como um keylogger que monitora tudo o que é digitado no computador da vítima. Uma vez executado, a única maneira de se livrar dele é formatando o computador. Este arquivo parece inocente, configurando algumas variáveis básicas necessárias para o selfbot funcionar, incluindo o token da conta do usuário.</p>
<p><img src="../icons/javascript/config.png"></p>

<h2>Arquivo index.js e Bibliotecas Externas (Libs)</h2>
<p>O perigo real está no arquivo index.js ou, em alguns casos, nas bibliotecas instaladas dentro da pasta do selfbot (geralmente organizadas em uma pasta chamada lib). Muitas pessoas executam este arquivo sem saber que ele contém código malicioso. Aqui, um keylogger é instalado no computador, comprometendo todas as informações digitadas, incluindo senhas. Mudar a senha não ajudará, pois o hacker continuará a receber todas as novas senhas. A única solução é formatar o computador. Além disso, selfbots frequentemente usam bibliotecas externas. Mesmo que o index.js não mostre nada suspeito após a deofuscação, é provável que as bibliotecas incluídas contenham o código malicioso, como keyloggers ocultos.</p>
<p><img src="../icons/javascript/selfbot-index.png"></p>

    </main>
    <footer>
      <a href="../index.html">/index.html</a>
    </footer>
  </body>
</html>
